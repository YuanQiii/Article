# 类型转换

## 数据类型

- 原始类型
  1. `undefined`
  2. `null`
  3. `boolean`
  4. `string`
  5. `number`
  6. `symbol`
- 对象类型
  1. `object`

## 类型转换

### 原始值转布尔值

- 当 `Boolean` 函数不传任何参数时，会返回 false

  ```js
  console.log(Boolean()) // false
  ```

  

| 参数类型  |  值   |
| :-------: | :---: |
| undefined | false |
|   null    | false |
|     0     | false |
|    NaN    | false |
|    ""     | false |
|   false   | false |
|   其他    | true  |

### 原始值转数字

- 无法被转换为数字，则返回 `NaN`
- `Number` 函数不传参数，返回 0

| 参数类型  |                      结果                      |
| :-------: | :--------------------------------------------: |
| Undefined |                      NaN                       |
|   Null    |                       0                        |
|  Boolean  | 如果参数是 true，返回 1。参数为 false，返回 +0 |
|  Number   |                返回与之相等的值                |
|  String   |               根据语法和转换规则               |

```js
Number("123")// 123
Number("-123") // -123
Number("1.2") // 1.2

// 忽略前导0
Number("000123") // 123
Number("-000123") // -123

Number("0x11")// 17

Number("") // 0
Number(" ") // 0

Number("123 123") // NaN
Number("foo") // NaN
Number("100a")// NaN
```

- `Number` 

  - 转换成一个整数或浮点数
  - 忽略所有前导的 0
  - 不是数字，结果都会返回 `NaN`

- `parseInt` & `parseFloat`

  - 字符串前缀是 `0x` 或者`0X`，`parseInt` 将其解释为十六进制数
  - 都会跳过任意数量的前导空格，尽可能解析更多数值字符，并忽略后面的内容
  - 如果第一个非空格字符是非法的数字直接量，将最终返回 `NaN`

  ```js
  parseInt("3 abc") // 3
  parseFloat("3.14 abc") // 3
  parseInt("-12.34") // -12
  parseInt("0xFF") // 255
  parseFloat(".1") // 0.1
  parseInt("0.1") // 0
  ```

### 原始值转字符

| 参数类型  |                           结果                           |
| :-------: | :------------------------------------------------------: |
| Undefined |                       "undefined"                        |
|   Null    |                          "null"                          |
|  Boolean  | 如果参数是 true，返回 "true"。参数为 false，返回 "false" |
|  Number   |                    根据语法和转换规则                    |
|  String   |                     返回与之相等的值                     |

```js
console.log(String(0)) // 0
console.log(String(-0)) // 0
console.log(String(NaN)) // NaN
console.log(String(Infinity)) // Infinity
console.log(String(-Infinity)) // -Infinity
console.log(String(1)) // 1
```

### 原始值转对象

- 原始值通过调用 `String()`、`Number()` 或者 `Boolean()` 构造函数，转换为它们各自的包装对象
- `null` 和 `undefined` 属于例外，当将它们用在期望是一个对象的地方都会造成一个类型错误 (`TypeError`) 异常，而不会执行正常的转换

```js
var a = 1;
console.log(typeof a); // number
var b = new Number(a);
console.log(typeof b); // object
```

### 对象转布尔值

- 所有对象(包括数组和函数)都转换为 true
- 对于包装对象也是这样

```js
console.log(Boolean(new Boolean(false))) // true
```

### 对象转字符串和数字

- Object 的转换规则

  - 调用一个 `ToPrimitive` 方法，将其转为基本类型
  -  `ToPrimitive` 方法，是输入一个值，然后返回一个一定是基本类型的值

- `ToPrimitive`

  ```JS
  ToPrimitive(input[, PreferredType])
  ```

  - input，表示要处理的输入值
  - `PreferredType`，非必填，表示希望转换成的类型，有两个值可以选，Number 或者 String
  - 如果传入的 input 是 Undefined、Null、Boolean、Number、String 类型，直接返回该值
  - 处理步骤
    1. 如果 obj 为 基本类型，直接返回
    2. 否则，调用 `valueOf` 方法，如果返回一个原始值，则 JavaScript 将其返回
    3. 否则，调用 `toString` 方法，如果返回一个原始值，则 JavaScript 将其返回
    4. 否则，JavaScript 抛出一个类型错误异常



- 所有的对象除了 null 和 undefined 之外的任何值都具有 `toString` 方法

- `Object.prototype.toString` 方法会根据这个对象的[[class]]内部属性，返回由 "[object " 和 class 和 "]" 三个部分组成的字符串

- `toString` 方法

  - 数组的 `toString` 方法将每个数组元素转换成一个字符串，并在元素之间添加逗号后合并成结果字符串
  - 函数的 `toString` 方法返回源代码字符串
  - 日期的 `toString` 方法返回一个可读的日期和时间字符串
  - `RegExp` 的 `toString` 方法返回一个表示正则表达式直接量的字符串

  ```js
  console.log(({}).toString()) // [object Object]
  
  console.log([].toString()) // ""
  console.log([0].toString()) // 0
  console.log([1, 2, 3].toString()) // 1,2,3
  console.log((function(){var a = 1;}).toString()) // function (){var a = 1;}
  console.log((/\d+/g).toString()) // /\d+/g
  console.log((new Date(2010, 0, 1)).toString()) // Fri Jan 01 2010 00:00:00 GMT+0800 (CST)
  ```

- `valueOf` 方法返回这个对象本身，日期是一个例外，它会返回它的一个内容表示: 1970 年 1 月 1 日以来的毫秒数

  ```js
  var date = new Date(2017, 4, 21);
  console.log(date.valueOf()) // 1495296000000
  ```

## 转换类型

### 显式类型转换

- 转化为 Number 类型：`Number()` / `parseFloat()` / `parseInt()`
- 转化为 String 类型：`String()` / `toString()`
- 转化为 Boolean 类型: `Boolean()`

### 隐式类型转换

- 转换为boolean

  - 逻辑判断或者有逻辑运算符时被触发（|| && !）

  ```js
  if(2) {}      // 逻辑判断触发隐式类型转换
  !!2           // 逻辑运算符触发隐式类型转换
  2 || 'hello'  // 逻辑运算符触发隐式类型转换
  ```

- 转换为string

  - `+` 运算符并且有一个操作数是 string 类型时被触发

  - 代表的字符串拼接

    - 有两边，一边是字符串，则会变成字符串拼接
    - 有两边，一边是对象

    ```js
    1 + '123'  //"1123"
    1 + {}     //"1[object Object]"
    ```

- 转换为number

  - 对不同类型的值使用运算符时，值可以在类型之间自动的转换
    - 比较操作（>, <, <=, >=）
    - 按位操作（| & ^ ~）
    - 算数操作（- + * / %）， **注意**：当 + 操作存在任意的操作数是 string 类型时，不会触发 number 类型的隐式转换
    - 一元 + 操作

## 操作符==两边的隐式转换规则

- 对象==字符串



## valueOf和toString

- valueOf函数会将Number、String、Boolean基础类型的对象类型值转换成 基础类型，Date类型转换为毫秒数，其它的返回对象本身
- toString方法会将所有对象转换为字符串









## 参考

- [帮你彻底弄懂 JavaScript 类型转换 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/85731460)
- [JavaScript专题之类型判断(上) · Issue #28 · mqyqingfeng/Blog (github.com)](https://github.com/mqyqingfeng/Blog/issues/28)
- [JavaScript深入之头疼的类型转换(上) - 掘金 (juejin.cn)](https://juejin.cn/post/6844904104402092039)
- [17道题彻底理解 JavaScript 中的类型转换 - 掘金 (juejin.cn)](https://juejin.cn/post/6844903907584376839)
- [Annotated ES5](http://es5.github.io/#x9.3)
- [通过面试题研究JavaScript数据类型转换 - 掘金 (juejin.cn)](https://juejin.cn/post/6956170676327677966#heading-5)
- [你所忽略的js隐式转换 - 掘金 (juejin.cn)](https://juejin.cn/post/6844903557968166926)

