# 类型转换

## 数据类型

- 原始类型
  1. `undefined`
  2. `null`
  3. `boolean`
  4. `string`
  5. `number`
  6. `symbol`
- 对象类型
  1. `object`

## 类型转换

### 原始值转布尔值

- 当 `Boolean` 函数不传任何参数时，会返回 false

  ```js
  console.log(Boolean()) // false
  ```

  

| 参数类型  |  值   |
| :-------: | :---: |
| undefined | false |
|   null    | false |
|     0     | false |
|    NaN    | false |
|    ""     | false |
|   false   | false |
|   其他    | true  |

### 原始值转数字

- 无法被转换为数字，则返回 `NaN`
- `Number` 函数不传参数，返回 0

| 参数类型  |                      结果                      |
| :-------: | :--------------------------------------------: |
| Undefined |                      NaN                       |
|   Null    |                       0                        |
|  Boolean  | 如果参数是 true，返回 1。参数为 false，返回 +0 |
|  Number   |                返回与之相等的值                |
|  String   |               根据语法和转换规则               |

```js
Number("123")// 123
Number("-123") // -123
Number("1.2") // 1.2

// 忽略前导0
Number("000123") // 123
Number("-000123") // -123

Number("0x11")// 17

Number("") // 0
Number(" ") // 0

Number("123 123") // NaN
Number("foo") // NaN
Number("100a")// NaN
```

- `Number` 

  - 转换成一个整数或浮点数
  - 忽略所有前导的 0
  - 不是数字，结果都会返回 `NaN`

- `parseInt` & `parseFloat`

  - 字符串前缀是 `0x` 或者`0X`，`parseInt` 将其解释为十六进制数
  - 都会跳过任意数量的前导空格，尽可能解析更多数值字符，并忽略后面的内容
  - 如果第一个非空格字符是非法的数字直接量，将最终返回 `NaN`

  ```js
  parseInt("3 abc") // 3
  parseFloat("3.14 abc") // 3
  parseInt("-12.34") // -12
  parseInt("0xFF") // 255
  parseFloat(".1") // 0.1
  parseInt("0.1") // 0
  ```

### 原始值转字符

| 参数类型  |                           结果                           |
| :-------: | :------------------------------------------------------: |
| Undefined |                       "undefined"                        |
|   Null    |                          "null"                          |
|  Boolean  | 如果参数是 true，返回 "true"。参数为 false，返回 "false" |
|  Number   |                    根据语法和转换规则                    |
|  String   |                     返回与之相等的值                     |

```js
console.log(String(0)) // 0
console.log(String(-0)) // 0
console.log(String(NaN)) // NaN
console.log(String(Infinity)) // Infinity
console.log(String(-Infinity)) // -Infinity
console.log(String(1)) // 1
```

### 原始值转对象

- 原始值通过调用 `String()`、`Number()` 或者 `Boolean()` 构造函数，转换为它们各自的包装对象
- `null` 和 `undefined` 属于例外，当将它们用在期望是一个对象的地方都会造成一个类型错误 (`TypeError`) 异常，而不会执行正常的转换

```js
var a = 1;
console.log(typeof a); // number
var b = new Number(a);
console.log(typeof b); // object
```

### 对象转布尔值

- 所有对象(包括数组和函数)都转换为 true
- 对于包装对象也是这样

```js
console.log(Boolean(new Boolean(false))) // true
```

### 对象转字符串和数字

- Object 的转换规则

  - 调用一个 `ToPrimitive` 方法，将其转为基本类型
  -  `ToPrimitive` 方法，是输入一个值，然后返回一个一定是基本类型的值

- `ToPrimitive`

  ```JS
  ToPrimitive(input[, PreferredType])
  ```

  - input，表示要处理的输入值
  - `PreferredType`，非必填，表示希望转换成的类型，有两个值可以选，Number 或者 String
  - 如果传入的 input 是 Undefined、Null、Boolean、Number、String 类型，直接返回该值
  - 处理步骤
    1. 如果 obj 为 基本类型，直接返回
    2. 否则，调用 `valueOf` 方法，如果返回一个原始值，则 JavaScript 将其返回
    3. 否则，调用 `toString` 方法，如果返回一个原始值，则 JavaScript 将其返回
    4. 否则，JavaScript 抛出一个类型错误异常



- 所有的对象除了 null 和 undefined 之外的任何值都具有 `toString` 方法

- `Object.prototype.toString` 方法会根据这个对象的[[class]]内部属性，返回由 "[object " 和 class 和 "]" 三个部分组成的字符串

- `toString` 方法

  - 数组的 `toString` 方法将每个数组元素转换成一个字符串，并在元素之间添加逗号后合并成结果字符串
  - 函数的 `toString` 方法返回源代码字符串
  - 日期的 `toString` 方法返回一个可读的日期和时间字符串
  - `RegExp` 的 `toString` 方法返回一个表示正则表达式直接量的字符串

  ```js
  console.log(({}).toString()) // [object Object]
  
  console.log([].toString()) // ""
  console.log([0].toString()) // 0
  console.log([1, 2, 3].toString()) // 1,2,3
  console.log((function(){var a = 1;}).toString()) // function (){var a = 1;}
  console.log((/\d+/g).toString()) // /\d+/g
  console.log((new Date(2010, 0, 1)).toString()) // Fri Jan 01 2010 00:00:00 GMT+0800 (CST)
  ```

- `valueOf` 方法返回这个对象本身，日期是一个例外，它会返回它的一个内容表示: 1970 年 1 月 1 日以来的毫秒数

  ```js
  var date = new Date(2017, 4, 21);
  console.log(date.valueOf()) // 1495296000000
  ```

## 转换类型

### 显式类型转换

- 转化为 Number 类型：`Number()` / `parseFloat()` / `parseInt()`
- 转化为 String 类型：`String()` / `toString()`
- 转化为 Boolean 类型: `Boolean()`

### 隐式类型转换

- 转换为Boolean

  - 逻辑判断或者有逻辑运算符时被触发（|| && !）

    ```js
    if(2) {}      // 逻辑判断触发隐式类型转换
    !!2           // 逻辑运算符触发隐式类型转换
    2 || 'hello'  // 逻辑运算符触发隐式类型转换
    ```

- 转换为String

  - `+` 运算符并且有一个操作数是 string 类型时被触发，代表的字符串拼接

    - 有两边，一边是字符串，则会变成字符串拼接
    - 有两边，一边是对象

    ```js
    1 + '123'  //"1123"
    1 + {}     //"1[object Object]"
    ```

  - Symbol 类型转 String 类型是比较严格的，它只能被显式的转换

    ```js
    String(Symbol('symbol'))  // 'Symbol(symbol)'
    
    '' + Symbol('symbol')  // TypeError is thrown
    ```

- 转换为Number

  - 对不同类型的值使用运算符时，值可以在类型之间自动的转换
    - 比较操作（>, <, <=, >=）
    - 按位操作（| & ^ ~）
    - 算数操作（- + * / %）， **注意**：当 + 操作存在任意的操作数是 string 类型时，不会触发 number 类型的隐式转换
    - 一元 + 操作
    - 非严格相等操作（== 或者 != ），**注意**，== 操作两个操作数都是 string 类型时，不会发生 number 类型的隐式转换
    
  - null 会转换为 0
  
  - undefined 会转换为 NaN
  
  - 不能将 Symbol 类型转为 number 类型
  
    ```js
    Number(Symbol('my symbol'))    // TypeError is thrown
    +Symbol('123')                 // TypeError is thrown
    ```
  
- 特殊

  - 当将 == 应用于 null 或 undefined 时，不会发生数值转换。null 只等于 null 或 undefined，不等于其他任何值

    ```js
    null == 0               // false, null is not converted to 0
    null == null            // true
    undefined == undefined  // true
    null == undefined       // true
    undefined == 0          // false
    ```

  - NaN 不等于任何值，包括它自己

    ```js
    NaN === NaN  // false
    ```

    

### 对象与原始类型的相比较

- `对象`与`原始类型`相比较时，会把`对象`按照`对象转换规则`转换成`原始类型`，再比较

```js
 {} == 0  // false
 {} == '[object object]'  // true
 [] == false  // true
 [1,2,3] == '1,2,3' // true
```

### 对象与对象相比较

- 如果两个对象指向同一个对象，相等操作符返回 `true`，否则为`false`



### 三种隐式转换类型

- 将值转为原始值，ToPrimitive()
- 将值转为数字，ToNumber()
- 将值转为字符串，ToString()



### 通过ToPrimitive将值转换为原始值

- ToPrimitive(input, PreferredType?)
- input是要转换的值，PreferredType是可选参数
- 转换结果一定是一个原始值（或者报错）
- PreferredType的值会按照这样的规则来自动设置
  - 该对象为Date类型，则PreferredType被设置为String
  - 否则，PreferredType被设置为Number

## valueOf和toString

- valueOf

  - Number、Boolean、String这三种构造函数生成的基础值的对象形式，通过valueOf转换后会变成相应的原始值

    ```js
    var num = new Number('123');
    num.valueOf(); // 123
    
    var str = new String('12df');
    str.valueOf(); // '12df'
    
    var bool = new Boolean('fd');
    bool.valueOf(); // true
    ```

  - Date这种特殊的对象，其原型Date.prototype上内置的valueOf函数将日期转换为日期的毫秒的形式的数值

    ```js
    var a = new Date();
    a.valueOf(); // 1515143895500
    ```

  - 除此之外返回的都为this，即对象本身

    ```js
    var a = new Array();
    a.valueOf() === a; // true
    
    var b = new Object({});
    b.valueOf() === b; // true
    ```

- toString

  - Number、Boolean、String、Array、Date、RegExp、Function这几种构造函数生成的对象，通过toString转换后会变成相应的字符串的形式，因为这些构造函数上封装了自己的toString方法

    ```js
    var num = new Number('123sd');
    num.toString(); // 'NaN'
    
    var str = new String('12df');
    str.toString(); // '12df'
    
    var bool = new Boolean('fd');
    bool.toString(); // 'true'
    
    var arr = new Array(1,2);
    arr.toString(); // '1,2'
    
    var d = new Date();
    d.toString(); // "Wed Oct 11 2017 08:00:00 GMT+0800 (中国标准时间)"
    
    var func = function () {}
    func.toString(); // "function () {}"
    
    var reg = new RegExp()
    reg.toString(); // '/(?:)/'
    ```

  - 其他对象返回的都是该对象的类型

    ```js
    var obj = new Object({});
    obj.toString(); // "[object Object]"
    
    Math.toString(); // "[object Math]"
    ```

    

## == 运算符转隐式转换

- 类型相同
  - 类型相同时，没有类型转换
  - NaN不与任何值相等，包括它自己，即NaN !== NaN
- 类型不相同
  - x,y 为null、undefined两者中一个
    - 返回true
  - x为null，y为String
    - 
  - x、y为Number和String类型时
    - 转换为Number类型比较
  - 有Boolean类型
    - Boolean转化为Number类型比较
  - 一个Object类型，一个String或Number类型
    - Object类型进行原始转换后，按上面流程进行原始值比较



## 参考

- [帮你彻底弄懂 JavaScript 类型转换 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/85731460)
- [JavaScript专题之类型判断(上) · Issue #28 · mqyqingfeng/Blog (github.com)](https://github.com/mqyqingfeng/Blog/issues/28)
- [JavaScript深入之头疼的类型转换(上) - 掘金 (juejin.cn)](https://juejin.cn/post/6844904104402092039)
- [17道题彻底理解 JavaScript 中的类型转换 - 掘金 (juejin.cn)](https://juejin.cn/post/6844903907584376839)
- [Annotated ES5](http://es5.github.io/#x9.3)
- [通过面试题研究JavaScript数据类型转换 - 掘金 (juejin.cn)](https://juejin.cn/post/6956170676327677966#heading-5)
- [你所忽略的js隐式转换 - 掘金 (juejin.cn)](https://juejin.cn/post/6844903557968166926)
- [带你撸一遍JS隐式转换细则 - 掘金 (juejin.cn)](https://juejin.cn/post/6844903934876745735#heading-7)

