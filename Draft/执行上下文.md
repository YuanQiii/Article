## 什么是执行上下文

- 执行上下文是评估和执行 JavaScript 代码的环境的抽象概念

## 执行上下文类型

- 全局执行上下文
- 函数执行上下文
- Eval 函数执行上下文

## 执行上下文重要属性

- 变量对象(Variable object，VO)
- 作用域链(Scope chain)
- this

## 执行上下文的生命周期

- 创建阶段

  > - **this** 值的决定，即我们所熟知的 **This 绑定**
  > - 创建**词法环境**组件
  > - 创建**变量环境**组件

  - 在这个阶段中，执行上下文会分别创建变量对象，建立作用域链，以及确定 this 的指向
    - 变量对象
      - 全局上下文的变量对象初始化是全局对象
      - 函数上下文的变量对象初始化只包括 Arguments 对象，给变量对象添加形参、函数声明、变量声明等初始的属性值
      - 首先会处理函数声明，其次会处理变量声明，如果变量名称跟已经声明的形式参数或函数相同，则变量声明不会干扰已经存在的这类属性
    - 作用域链

- 代码执行阶段

  - 创建完成之后，就会开始执行代码，这个时候，会完成变量赋值，函数引用，以及执行其他代码
    - 变量对象
      - 再次修改变量对象的属性值

## 变量对象

- 变量对象是与执行上下文相关的数据作用域，存储了在上下文中定义的变量和函数声明
- 全局上下文中的变量对象就是全局对象
- 在函数上下文中用活动对象(activation object, AO)来表示

## 全局对象

- 全局对象是预定义的对象，作为 JavaScript 的全局函数和全局属性的占位符。通过使用全局对象，可以访问所有其他所有预定义的对象、函数和属性
- 在顶层 JavaScript 代码中，可以用关键字 this 引用全局对象。因为全局对象是作用域链的头，这意味着所有非限定性的变量和函数名都会作为该对象的属性来查询

## 作用域

- 作用域是指程序源代码中定义变量的区域
- 作用域规定了如何查找变量，也就是确定当前执行代码对变量的访问权限
- JavaScript 采用词法作用域(lexical scoping)，也就是静态作用域

## 静态作用域与动态作用域

- 词法作用域，函数的作用域在函数定义的时候就决定
- 动态作用域，函数的作用域是在函数调用的时候才决定

## 执行栈

- 执行栈，也是“调用栈”
- 是一种拥有 LIFO（后进先出）数据结构的栈，被用来存储代码运行时创建的所有执行上下文

## 参考

- [[译\] 理解 JavaScript 中的执行上下文和执行栈 - 掘金 (juejin.cn)](https://juejin.cn/post/6844903682283143181)
- [JavaScript深入之执行上下文栈 · Issue #4 · mqyqingfeng/Blog (github.com)](https://github.com/mqyqingfeng/Blog/issues/4)

