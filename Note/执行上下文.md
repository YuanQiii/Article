## 执行上下文

### 什么是执行上下文

- 执行上下文是评估和执行 JavaScript 代码的环境的抽象概念
- 每当 JavaScript 代码在运行的时候，它都是在执行上下文中运行

### 执行上下文的类型

- **全局执行上下文**
  - 任何不在函数内部的代码都在全局上下文中
  - 创建一个全局的 `window` 对象（浏览器的情况下），并且设置 `this` 的值等于这个全局对象
- **函数执行上下文**
  - 每当一个函数被调用时, 都会为该函数创建一个新的上下文
  - 在函数被调用时创建
- **Eval 函数执行上下文** 
  - 执行在 `eval` 函数内部的代码也会有它属于自己的执行上下文

## 执行栈

- 被用来存储代码运行时创建的所有执行上下文
- 当引擎第一次遇到你的脚本时，它会创建一个全局的执行上下文并且压入当前执行栈
- 遇到一个函数调用，它会为该函数创建一个新的执行上下文并压入栈的顶部
- 引擎会执行那些执行上下文位于栈顶的函数

## 创建执行上下文

### 创建阶段

- **this** 值的决定，即我们所熟知的 **This 绑定**
  - 在全局执行上下文中，`this` 的值指向全局对象
  - 在函数执行上下文中，`this` 的值取决于该函数是如何被调用的
- 创建**词法环境**组件
  - **词法环境**是一种持有**标识符—变量映射**的结构
    - **标识符**指的是变量/函数的名字
    - **变量**是对实际对象[包含函数类型对象]或原始数据的引用）
  - **内部**有两个组件
    - **环境记录器**是存储变量和函数声明的实际位置
    - **外部环境的引用**意味着它可以访问其父级词法环境（作用域）
  - **词法环境**有两种类型
    - **全局环境**（在全局执行上下文中）是没有外部环境引用的词法环境
    - **函数环境**函数内部用户定义的变量存储在**环境记录器**中。并且引用的外部环境可能是全局环境，或者任何包含此内部函数的外部函数
- 创建**变量环境**组件

```js
ExecutionContext = {
  ThisBinding = <this value>,
  LexicalEnvironment = { ... },
  VariableEnvironment = { ... },
}
```

















